!function(factory){if("object"==typeof exports)module.exports=factory(require("underscore"),require("backbone"));else if("function"==typeof define&&define.amd)define(["underscore","backbone"],factory);else if("undefined"!=typeof _&&"undefined"!=typeof Backbone){var oldPageableCollection=Backbone.PageableCollection,PageableCollection=factory(_,Backbone);Backbone.PageableCollection.noConflict=function(){return Backbone.PageableCollection=oldPageableCollection,PageableCollection}}}(function(_,Backbone){"use strict";var BBColProto=Backbone.Collection.prototype,PageableCollection=Backbone.PageableCollection=Backbone.Collection.extend({state:{firstPage:1,lastPage:null,currentPage:null,pageSize:25,totalPages:null,totalRecords:null,sortKey:null,order:-1},mode:"server",queryParams:{currentPage:"page",pageSize:"per_page",totalPages:"total_pages",totalRecords:"total_entries",sortKey:"sort_by",order:"order",directions:{"-1":"asc",1:"desc"}},constructor:function(models,options){options=options||{};var state=this.state=_.extend({},PageableProto.state,this.state,options.state||{});state.currentPage=state.firstPage,this._makeFullCollection(models),BBColProto.constructor.apply(this,arguments)},getFirstPage:function(){this.getPage("first")},getLastPage:function(){this.getPage("last")},getNextPage:function(){this.getPage("next")},getPreviousPage:function(){this.getPage("previous")},getPage:function(page){var totalPages=this.state.totalPages?this.state.totalPages:Math.ceil(this.fullCollection.length/this.state.pageSize);switch(page){case"first":page=0;break;case"last":page=totalPages-1;break;case"next":page=++this.state.currentPage;break;case"previous":page=--this.state.currentPage}this.state.currentPage=page,"server"===this.mode?this.fetch():this._paginate()},trigger:function(event){var mode=this.mode;"sync"===event&&"client"===mode&&this._paginate(!0),"reset"===event&&"client"===mode&&(this.state.totalPages=Math.ceil(this.fullCollection.length/this.state.pageSize))},_makeFullCollection:function(models){this.fullCollection=new Backbone.Collection(models)},_paginate:function(sync){var state=_.clone(this.state),currentPage=state.currentPage,pageSize=state.pageSize,pageStart=currentPage*pageSize,pageEnd=pageStart+pageSize;"client"===this.mode&&sync&&this._makeFullCollection(this.models),this.reset(this.models.slice(pageStart,pageEnd))},fetch:function(options){options=options||{};var state=this.state,queryParams=this.queryParams,data={};return _.each(queryParams,function(value,key){state[key]&&(data[value]=state[key])}),options.data=data,BBColProto.fetch.call(this,options)}}),PageableProto=PageableCollection.prototype});